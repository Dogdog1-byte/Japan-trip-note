<!DOCTYPE html>
<html class="light" lang="zh-Hant">

<head>
    <meta charset="utf-8" />
    <meta content="width=device-width, initial-scale=1.0" name="viewport" />
    <title>è¡Œç¨‹è©³æƒ… (å³æ™‚åŒæ­¥)</title>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700;800&amp;display=swap"
        rel="stylesheet" />
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700&amp;display=swap"
        rel="stylesheet" />
    <link
        href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght,FILL@100..700,0..1&amp;display=swap"
        rel="stylesheet" />
    <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
    <script>
        tailwind.config = {
            darkMode: "class",
            theme: {
                extend: {
                    colors: {
                        "primary": "var(--primary-color, #2563EB)",
                        "primary-content": "#ffffff",
                        "background-light": "var(--background-light-color, #eff6ff)",
                        "background-dark": "#0f172a",
                        "surface-light": "#ffffff",
                        "surface-dark": "#1e293b",
                        "text-main-light": "#1e293b",
                        "text-main-dark": "#f8fafc",
                        "text-sub-light": "#64748b",
                        "text-sub-dark": "#94a3b8",
                    },
                    fontFamily: {
                        "display": ["Plus Jakarta Sans", "Noto Sans TC", "sans-serif"]
                    },
                    borderRadius: { "DEFAULT": "1rem", "lg": "1.5rem", "xl": "2rem", "2xl": "2.5rem", "full": "9999px" },
                },
            },
        }
    </script>
</head>

<body
    class="bg-background-light dark:bg-background-dark min-h-screen text-text-main-light dark:text-text-main-dark flex justify-center">
    <div
        class="relative flex h-full min-h-screen w-full max-w-md flex-col overflow-x-hidden bg-background-light dark:bg-background-dark pb-24">

        <!-- Header -->
        <header
            class="sticky top-0 z-20 bg-background-light/90 dark:bg-background-dark/90 backdrop-blur-sm px-4 pt-8 pb-4 border-b border-gray-100 dark:border-gray-800 flex items-center justify-between">
            <button onclick="location.href='trips.html'"
                class="p-2 -ml-2 rounded-full hover:bg-gray-100 dark:hover:bg-white/10 transition">
                <span class="material-symbols-outlined">arrow_back</span>
            </button>
            <div class="flex-1 flex flex-col items-center mx-2 overflow-hidden">
                <button onclick="editTripName()"
                    class="flex items-center gap-1 max-w-full hover:opacity-70 transition group">
                    <h1 id="header-title" class="text-lg font-bold truncate">è¼‰å…¥ä¸­...</h1>
                    <span
                        class="material-symbols-outlined text-sm opacity-0 group-hover:opacity-50 transition">edit</span>
                </button>
                <p id="trip-date-display"
                    class="text-xs text-text-sub-light dark:text-text-sub-dark flex items-center justify-center gap-1">
                    ...
                </p>
                <button onclick="editMembers()" id="members-display"
                    class="text-[10px] bg-primary/10 text-primary px-2 py-0.5 rounded-full mt-1 font-bold hover:bg-primary/20 transition">
                    ğŸ‘¥ è¨­å®šæˆå“¡
                </button>
            </div>
            <button onclick="shareTrip()"
                class="p-2 -mr-2 rounded-full hover:bg-gray-100 dark:hover:bg-white/10 transition text-primary">
                <span class="material-symbols-outlined">share</span>
            </button>
        </header>

        <!-- Date Tabs -->
        <div
            class="sticky top-[80px] z-10 bg-background-light dark:bg-background-dark py-2 px-2 overflow-x-auto no-scrollbar border-b border-gray-100 dark:border-gray-800">
            <div id="days-container" class="flex gap-2 min-w-max px-2">
                <!-- Days Injected Here -->
            </div>
        </div>

        <main class="flex-1 px-4 pt-6 pb-20">
            <div class="flex items-center justify-between mb-6">
                <h2 id="trip-day-display" class="text-2xl font-extrabold">Day 1</h2>
                <span id="items-count"
                    class="text-xs font-bold bg-white dark:bg-surface-dark px-3 py-1 rounded-full shadow-sm">0
                    å€‹è¡Œç¨‹</span>
            </div>

            <!-- Timeline -->
            <div id="itinerary-timeline" class="relative pl-2">
                <!-- Items Injected Here -->
            </div>
        </main>

        <!-- FAB -->
        <div class="fixed bottom-24 right-5 z-40">
            <button onclick="openModal()"
                class="flex size-14 items-center justify-center rounded-full bg-primary text-primary-content shadow-lg shadow-primary/30 transition hover:scale-105 active:scale-95">
                <span class="material-symbols-outlined" style="font-size: 28px;">add</span>
            </button>
        </div>

        <!-- Create/Edit Modal -->
        <div id="modal-overlay"
            class="fixed inset-0 z-50 bg-black/40 backdrop-blur-sm hidden opacity-0 transition-opacity duration-300"
            onclick="closeModal()"></div>
        <div id="modal-content"
            class="fixed bottom-0 left-0 right-0 z-50 bg-surface-light dark:bg-surface-dark rounded-t-3xl p-6 transform translate-y-full transition-transform duration-300 max-h-[85vh] overflow-y-auto max-w-md mx-auto">
            <div class="w-12 h-1.5 bg-gray-300 dark:bg-gray-600 rounded-full mx-auto mb-6"></div>

            <div class="flex justify-between items-center mb-6">
                <h3 id="modal-title" class="text-xl font-bold">æ–°å¢è¡Œç¨‹</h3>
                <button type="button" id="deleteBtn" onclick="deleteCurrentItem()"
                    class="text-red-500 font-bold text-sm hidden flex items-center gap-1">
                    <span class="material-symbols-outlined text-sm">delete</span> åˆªé™¤
                </button>
            </div>

            <form id="itemForm" onsubmit="handleFormSubmit(event)" class="space-y-5">
                <input type="hidden" id="itemId">

                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="block text-xs font-bold mb-1.5 ml-1 text-text-sub-light">æ™‚é–“</label>
                        <input type="time" id="itemTime" required
                            class="w-full bg-gray-50 dark:bg-black/20 border-none rounded-xl p-3 text-lg font-bold focus:ring-1 focus:ring-primary text-center">
                    </div>
                    <div>
                        <label class="block text-xs font-bold mb-1.5 ml-1 text-text-sub-light">é¡å‹</label>
                        <select id="itemTag"
                            class="w-full bg-gray-50 dark:bg-black/20 border-none rounded-xl p-3 font-medium focus:ring-1 focus:ring-primary">
                            <option value="æ™¯é»">ğŸ—» æ™¯é»</option>
                            <option value="ç¾é£Ÿ">ğŸœ ç¾é£Ÿ</option>
                            <option value="äº¤é€š">ğŸš„ äº¤é€š</option>
                            <option value="ä½å®¿">ğŸ¨ ä½å®¿</option>
                            <option value="è³¼ç‰©">ğŸ›ï¸ è³¼ç‰©</option>
                        </select>
                    </div>
                </div>

                <div>
                    <label class="block text-xs font-bold mb-1.5 ml-1 text-text-sub-light">åç¨± (é¸å¡«)</label>
                    <input type="text" id="itemName" placeholder="ä¾‹å¦‚ï¼šæ¸…æ°´å¯º"
                        class="w-full bg-gray-50 dark:bg-black/20 border-none rounded-xl p-4 text-base font-bold focus:ring-1 focus:ring-primary">
                </div>

                <div>
                    <label class="block text-xs font-bold mb-1.5 ml-1 text-text-sub-light">ç¶²å€ (é¸å¡«)</label>
                    <input type="url" id="itemUrl" placeholder="https://..."
                        class="w-full bg-gray-50 dark:bg-black/20 border-none rounded-xl p-4 text-sm focus:ring-1 focus:ring-primary">
                </div>

                <div>
                    <label class="block text-xs font-bold mb-1.5 ml-1 text-text-sub-light">å‚™è¨» (é¸å¡«)</label>
                    <textarea id="itemDesc" rows="2" placeholder="é–€ç¥¨åƒ¹æ ¼ã€è¨‚ä½è³‡è¨Š..."
                        class="w-full bg-gray-50 dark:bg-black/20 border-none rounded-xl p-4 text-sm focus:ring-1 focus:ring-primary"></textarea>
                </div>

                <div>
                    <label class="block text-xs font-bold mb-1.5 ml-1 text-text-sub-light">ç…§ç‰‡ (é¸å¡«)</label>
                    <div class="flex items-center gap-4">
                        <label
                            class="flex-1 cursor-pointer bg-gray-50 dark:bg-black/20 rounded-xl p-3 flex items-center justify-center gap-2 hover:bg-gray-100 dark:hover:bg-white/5 transition">
                            <span class="material-symbols-outlined text-primary">add_photo_alternate</span>
                            <span class="text-xs font-bold text-text-sub-light">ä¸Šå‚³ç…§ç‰‡</span>
                            <input type="file" accept="image/*" class="hidden" onchange="handleImageUpload(event)">
                        </label>
                        <input type="hidden" id="itemImage">
                    </div>
                    <div id="imagePreview" class="hidden mt-3 relative w-full h-32 rounded-xl overflow-hidden group">
                        <img id="previewImg" class="w-full h-full object-cover">
                        <button type="button"
                            onclick="document.getElementById('itemImage').value=''; document.getElementById('imagePreview').classList.add('hidden')"
                            class="absolute top-2 right-2 bg-black/50 text-white rounded-full p-1 hover:bg-red-500 transition">
                            <span class="material-symbols-outlined text-sm">close</span>
                        </button>
                    </div>
                </div>

                <div class="pt-4">
                    <button type="submit"
                        class="w-full py-4 bg-primary text-primary-content rounded-2xl font-bold text-lg shadow-lg shadow-primary/20 hover:scale-[1.02] active:scale-95 transition-transform">
                        å„²å­˜è¡Œç¨‹
                    </button>
                </div>
            </form>
        </div>

        <!-- Bottom Navigation -->
        <nav
            class="fixed bottom-0 z-30 w-full max-w-md bg-surface-light dark:bg-surface-dark border-t border-gray-100 dark:border-gray-800 pb-safe pt-2">
            <div class="flex justify-around items-center h-16 px-2">
                <a href="trips.html"
                    class="flex flex-col items-center justify-center w-full h-full space-y-1 text-text-sub-light dark:text-text-sub-dark hover:text-text-main-light dark:hover:text-text-main-dark transition-colors">
                    <span class="material-symbols-outlined">home</span>
                    <span class="text-[10px] font-medium">é¦–é </span>
                </a>
                <a href="checklist.html"
                    class="flex flex-col items-center justify-center w-full h-full space-y-1 text-text-sub-light dark:text-text-sub-dark hover:text-text-main-light dark:hover:text-text-main-dark transition-colors">
                    <span class="material-symbols-outlined">checklist</span>
                    <span class="text-[10px] font-medium">å¾…è¾¦</span>
                </a>
                <a href="expenses.html"
                    class="flex flex-col items-center justify-center w-full h-full space-y-1 text-text-sub-light dark:text-text-sub-dark hover:text-text-main-light dark:hover:text-text-main-dark transition-colors">
                    <span class="material-symbols-outlined">payments</span>
                    <span class="text-[10px] font-medium">è¨˜å¸³</span>
                </a>
                <a href="settings.html"
                    class="flex flex-col items-center justify-center w-full h-full space-y-1 text-text-sub-light dark:text-text-sub-dark hover:text-text-main-light dark:hover:text-text-main-dark transition-colors">
                    <span class="material-symbols-outlined">settings</span>
                    <span class="text-[10px] font-medium">è¨­å®š</span>
                </a>
            </div>
        </nav>
    </div>

    <!-- Theme & Firebase Logic -->
    <script type="module">
        import './theme-manager.js';
        import { initApp, listenToTrip, updateTrip, getGroupId, getUserName } from './firebase-manager.js';

        let currentTrip = null;
        let currentDayIndex = 0;
        let tripDays = [];
        let tripId = null;

        // Auto Dark Mode
        if (localStorage.getItem('darkMode') === 'true') {
            document.documentElement.classList.add('dark');
        }

        document.addEventListener('DOMContentLoaded', () => {
            const urlParams = new URLSearchParams(window.location.search);
            tripId = urlParams.get('id');

            if (!tripId) {
                alert('No Trip ID');
                location.href = 'trips.html';
                return;
            }

            // Init Connection
            const isConfigured = initApp();
            if (!isConfigured) {
                alert("å°šæœªç™»å…¥ç¾¤çµ„ï¼Œå°‡è·³è½‰å›é¦–é ");
                location.href = 'trips.html';
                return;
            }

            // Start Listening
            listenToTrip(tripId, (tripData) => {
                if (!tripData) {
                    if (currentTrip && !tripData) {
                        alert("è¡Œç¨‹å·²è¢«åˆªé™¤");
                        location.href = 'trips.html';
                    }
                    return;
                }

                // Update UI (simplified diff check)
                if (JSON.stringify(currentTrip) !== JSON.stringify(tripData)) {
                    currentTrip = tripData;
                    renderAll();
                }
            });
        });

        // Make functions global for HTML handlers
        window.switchDay = function (index) {
            currentDayIndex = index;
            renderTabs();
            renderTimeline();
        }

        window.openModal = function (isEdit = false) {
            const modalOverlay = document.getElementById('modal-overlay');
            const modalContent = document.getElementById('modal-content');
            modalOverlay.classList.remove('hidden');
            void modalOverlay.offsetWidth; // trigger reflow
            modalOverlay.classList.remove('opacity-0');
            modalContent.classList.remove('translate-y-full');

            if (!isEdit) {
                document.getElementById('itemForm').reset();
                document.getElementById('itemId').value = '';
                document.getElementById('modal-title').innerText = 'æ–°å¢è¡Œç¨‹';
                document.getElementById('deleteBtn').classList.add('hidden');
                document.getElementById('itemTime').value = '09:00';
                document.getElementById('imagePreview').classList.add('hidden');
                document.getElementById('itemUrl').value = '';
            } else {
                const imgUrl = document.getElementById('itemImage').value;
                if (imgUrl) {
                    document.getElementById('previewImg').src = imgUrl;
                    document.getElementById('imagePreview').classList.remove('hidden');
                }
            }
        }

        window.closeModal = function () {
            const modalOverlay = document.getElementById('modal-overlay');
            const modalContent = document.getElementById('modal-content');
            modalOverlay.classList.add('opacity-0');
            modalContent.classList.add('translate-y-full');
            setTimeout(() => modalOverlay.classList.add('hidden'), 300);
        }

        window.handleImageUpload = function (event) {
            const file = event.target.files[0];
            if (!file) return;
            const reader = new FileReader();
            reader.onload = (e) => {
                const base64 = e.target.result;
                document.getElementById('itemImage').value = base64;
                document.getElementById('previewImg').src = base64;
                document.getElementById('imagePreview').classList.remove('hidden');
            };
            reader.readAsDataURL(file);
        }

        window.handleFormSubmit = function (e) {
            e.preventDefault();
            const id = document.getElementById('itemId').value;
            const dayKey = `day${currentDayIndex + 1}`;

            if (!currentTrip.itinerary) currentTrip.itinerary = {};
            if (!currentTrip.itinerary[dayKey]) currentTrip.itinerary[dayKey] = [];

            const newItem = {
                id: id ? parseInt(id) : Date.now(),
                time: document.getElementById('itemTime').value,
                name: document.getElementById('itemName').value || 'æœªå‘½åé …ç›®',
                desc: document.getElementById('itemDesc').value,
                tag: document.getElementById('itemTag').value,
                image: document.getElementById('itemImage').value,
                link: document.getElementById('itemUrl').value
            };

            if (id) {
                const idx = currentTrip.itinerary[dayKey].findIndex(i => i.id == id);
                if (idx !== -1) currentTrip.itinerary[dayKey][idx] = newItem;
            } else {
                currentTrip.itinerary[dayKey].push(newItem);
            }

            saveTrip();
            window.closeModal();
        }

        window.editItem = function (id) {
            const dayKey = `day${currentDayIndex + 1}`;
            const item = currentTrip.itinerary[dayKey].find(i => i.id == id);
            if (!item) return;

            document.getElementById('itemId').value = item.id;
            document.getElementById('itemTime').value = item.time;
            document.getElementById('itemName').value = item.name;
            document.getElementById('itemDesc').value = item.desc || '';
            document.getElementById('itemTag').value = item.tag || 'æ™¯é»';
            document.getElementById('itemImage').value = item.image || '';
            document.getElementById('itemUrl').value = item.link || '';

            document.getElementById('modal-title').innerText = 'ç·¨è¼¯è¡Œç¨‹';
            document.getElementById('deleteBtn').classList.remove('hidden');
            window.openModal(true);
        }

        window.deleteCurrentItem = function () {
            if (!confirm('ç¢ºå®šåˆªé™¤ï¼Ÿ')) return;
            const id = document.getElementById('itemId').value;
            const dayKey = `day${currentDayIndex + 1}`;
            currentTrip.itinerary[dayKey] = currentTrip.itinerary[dayKey].filter(i => i.id != id);
            saveTrip();
            window.closeModal();
        }

        window.editMembers = function () {
            if (!currentTrip) return;
            const currentMembers = currentTrip.members ? currentTrip.members.join(', ') : '';
            const input = prompt("è«‹è¼¸å…¥æ‰€æœ‰æˆå“¡æš±ç¨±ï¼Œç”¨é€—è™Ÿéš”é–‹ï¼š\n(ä¾‹å¦‚ï¼šçˆ¸çˆ¸, åª½åª½, æˆ‘)", currentMembers);
            if (input !== null) {
                const nicknames = input.split(',').map(s => s.trim()).filter(s => s !== '');
                currentTrip.members = nicknames.length > 0 ? nicknames : null;
                saveTrip();
                renderAll();
            }
        }

        window.shareTrip = function () {
            const groupId = getGroupId();
            alert(`ç›®å‰ä½æ–¼ç¾¤çµ„ï¼š${groupId}\nè«‹æœ‹å‹åœ¨é¦–é è¼¸å…¥æ­¤ ID å³å¯åŒæ­¥ç·¨è¼¯ã€‚`);
        }

        window.editTripName = function () {
            if (!currentTrip) return;
            const newName = prompt("è«‹è¼¸å…¥æ–°çš„è¡Œç¨‹åç¨±ï¼š", currentTrip.name);
            if (newName && newName.trim()) {
                currentTrip.name = newName.trim();
                saveTrip();
                renderAll();
            }
        }

        // --- Core Rendering ---

        function renderAll() {
            document.getElementById('header-title').innerText = currentTrip.name;

            // Render Members
            const membersEl = document.getElementById('members-display');
            if (currentTrip.members && currentTrip.members.length > 0) {
                membersEl.innerText = `ğŸ‘¥ ${currentTrip.members.join(', ')}`;
            } else {
                membersEl.innerText = `ğŸ‘¥ è¨­å®šæˆå“¡`;
            }

            // Show Last Editor Info
            if (currentTrip.lastEditor) {
                document.getElementById('trip-date-display').innerHTML =
                    `${new Date(currentTrip.start).toLocaleDateString()} <span class="ml-2 text-primary font-bold">âœï¸ ${currentTrip.lastEditor}</span>`;
            } else {
                document.getElementById('trip-date-display').innerText = new Date(currentTrip.start).toLocaleDateString();
            }

            // Calc Days
            const start = new Date(currentTrip.start);
            const end = new Date(currentTrip.end);
            tripDays = [];
            for (let dt = new Date(start); dt <= end; dt.setDate(dt.getDate() + 1)) {
                tripDays.push(new Date(dt));
            }
            if (currentDayIndex >= tripDays.length) currentDayIndex = 0;

            renderTabs();
            renderTimeline();
        }

        function renderTabs() {
            const container = document.getElementById('days-container');
            // Chinese Weekday Map
            const daysMap = ['é€±æ—¥', 'é€±ä¸€', 'é€±äºŒ', 'é€±ä¸‰', 'é€±å››', 'é€±äº”', 'é€±å…­'];

            container.innerHTML = tripDays.map((date, index) => {
                const isActive = index === currentDayIndex;
                const dateStr = date.toISOString().split('T')[0];
                const dayNum = date.getDate();
                const weekDay = daysMap[date.getDay()];
                const dayLabel = `Day ${index + 1}`;

                return `
                    <button onclick="switchDay(${index})" 
                        class="flex flex-col items-center min-w-[64px] p-1.5 rounded-xl transition-all ${isActive ? 'bg-primary text-primary-content shadow-lg shadow-primary/30 scale-105' : 'bg-white dark:bg-surface-dark border border-gray-100 dark:border-gray-800'}">
                        <span class="text-[9px] font-bold opacity-70 mb-0.5">${dayLabel}</span>
                        <div class="flex items-baseline gap-1">
                            <span class="text-lg font-black">${dayNum}</span>
                            <span class="text-[9px] font-bold opacity-90">${weekDay}</span>
                        </div>
                    </button>
                `;
            }).join('');
            document.getElementById('trip-day-display').innerText = `Day ${currentDayIndex + 1}`;
        }

        function renderTimeline() {
            const container = document.getElementById('itinerary-timeline');
            const dayKey = `day${currentDayIndex + 1}`;
            const items = (currentTrip.itinerary && currentTrip.itinerary[dayKey]) ? currentTrip.itinerary[dayKey] : [];
            items.sort((a, b) => a.time.localeCompare(b.time));

            document.getElementById('items-count').innerText = `${items.length} è¡Œç¨‹`;

            if (items.length === 0) {
                container.innerHTML = `<div class="absolute bottom-0 left-[23px] top-2 w-0.5 bg-gray-200 dark:bg-gray-800"></div><div class="pl-12 py-10 text-slate-400 text-sm italic">é»æ“Šå³ä¸‹è§’ + æ–°å¢è¡Œç¨‹</div>`;
                return;
            }

            let html = '<div class="absolute bottom-0 left-[23px] top-2 w-0.5 bg-gray-200 dark:bg-gray-800"></div>';
            items.forEach((item, index) => {
                const tag = item.tag || 'ä¸€èˆ¬';
                const image = item.image;
                const iconMap = {
                    'æ™¯é»': 'landscape',
                    'ç¾é£Ÿ': 'restaurant',
                    'äº¤é€š': 'directions_transit',
                    'ä½å®¿': 'hotel',
                    'è³¼ç‰©': 'shopping_bag'
                };
                const tagIcon = iconMap[tag] || 'push_pin';

                const imageBoxClass = image ? 'w-20 h-20' : 'w-12 h-12';
                const iconSize = image ? 'text-3xl' : 'text-xl';
                const tagFontSize = image ? 'text-[8px]' : 'text-[7px]';

                const imageRender = image ?
                    `<img src="${image}" class="h-full w-full object-cover" />` :
                    `<div class="h-full w-full bg-primary/10 dark:bg-primary/20 flex flex-col items-center justify-center text-primary opacity-60">
                        <span class="material-symbols-outlined ${iconSize}">${tagIcon}</span>
                        <span class="${tagFontSize} font-bold mt-0.5 uppercase">${tag}</span>
                    </div>`;

                html += `
                <div class="relative mb-6 pl-8 group">
                    <div class="absolute left-[15px] top-6 z-10 box-border size-4 -translate-x-1/2 rounded-full border-[3px] border-background-light bg-primary dark:border-background-dark group-hover:scale-125 transition-transform"></div>
                    <div class="mb-1 flex items-center gap-2">
                        <span class="text-sm font-bold text-text-main-light dark:text-text-main-dark font-mono bg-gray-100 dark:bg-gray-800 px-2 py-0.5 rounded-md">${item.time}</span>
                    </div>
                    <div class="flex gap-2 overflow-hidden rounded-2xl bg-white dark:bg-surface-dark shadow-sm border border-transparent hover:border-primary/20 transition-all p-2 pr-3 cursor-pointer" onclick="editItem(${item.id})">
                        <div class="relative shrink-0 rounded-xl overflow-hidden bg-gray-100 dark:bg-black/20 ${imageBoxClass}">
                             ${imageRender}
                        </div>
                        <div class="flex flex-col justify-center min-w-0 flex-1 py-1">
                            <h3 class="text-sm font-bold text-text-main-light dark:text-text-main-dark break-words leading-tight">${item.name}</h3>
                            <p class="text-[11px] text-text-sub-light dark:text-text-sub-dark mt-0.5 whitespace-pre-wrap">${item.desc || 'ç„¡å‚™è¨»'}</p>
                            <div class="flex items-center gap-2 mt-2">
                                <span class="text-[10px] font-bold bg-gray-100 dark:bg-gray-700 px-2 py-0.5 rounded text-gray-500 dark:text-gray-300">${tag}</span>
                                ${item.link ? `
                                    <a href="${item.link}" target="_blank" onclick="event.stopPropagation()" class="flex items-center gap-1 text-[10px] font-bold text-primary bg-primary/10 px-2 py-0.5 rounded hover:bg-primary/20 transition">
                                        <span class="material-symbols-outlined text-xs">link</span> é€£çµ
                                    </a>
                                ` : ''}
                            </div>
                        </div>
                        <span class="material-symbols-outlined text-gray-300">chevron_right</span>
                    </div>
                </div>`;
            });
            container.innerHTML = html;
        }

        function saveTrip() {
            updateTrip(currentTrip);
        }

        function getDefaultImage(tag) {
            const map = {
                'æ™¯é»': 'https://images.unsplash.com/photo-1528361855426-3d2315b9c7b1?w=200&h=200&fit=crop',
                'ç¾é£Ÿ': 'https://images.unsplash.com/photo-1534422298391-e4f8c172dddb?w=200&h=200&fit=crop',
                'äº¤é€š': 'https://images.unsplash.com/photo-1550509657-3b2d12e69784?w=200&h=200&fit=crop',
                'ä½å®¿': 'https://images.unsplash.com/photo-1542314831-068cd1dbfeeb?w=200&h=200&fit=crop',
                'è³¼ç‰©': 'https://images.unsplash.com/photo-1483985988355-763728e1935b?w=200&h=200&fit=crop',
            };
            return map[tag] || map['æ™¯é»'];
        }
    </script>
</body>

</html>